<!-- /views/partials/bottom-nav.ejs -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<nav class="bottom-nav">
<a href="#" class="nav-item" title="Tags" onclick="togglePanel('tagsPanel')">
  <i class="fas fa-tags"></i>
</a>
  <a href="#" class="nav-item" title="Account" onclick="togglePanel('accountPanel')">
    <i class="fas fa-user"></i>
  </a>
  <a href="/" class="nav-item" title="Home">
    <i class="fas fa-home"></i>
  </a>
  <a href="/explore" class="nav-item" title="Explore">
    <i class="fas fa-compass"></i>
  </a>
  <a href="#" class="nav-item" title="More" onclick="togglePanel('morePanel')">
    <i class="fas fa-ellipsis-h"></i>
  </a>
</nav>

<!-- Account Panel -->
<div class="nav-panel" id="accountPanel">
  <% if (isLoggedIn) { %>
    <a href="/dashboard">Dashboard</a>
    <a href="#" id="myProfileBtn">My Profile</a>
    <% if (role === 'moderator' || role === 'admin') { %>
      <a href="/moderator-hub" id="modLink">Moderator Hub</a>
    <% } %>
    <% if (role === 'admin') { %>
      <a href="/admin-panel" id="adminLink">Admin Panel</a>
    <% } %>
    <button id="logoutBtn">Logout</button>
  <% } else { %>
    <a href="/login" id="loginBtn">🔐 Login</a>
    <a href="/register" id="regsterBtn">⚙️ Register</a>
  <% } %>
</div>

<!-- More Panel -->
<div class="nav-panel" id="morePanel">
  <button id="toggleDarkModeBtn">🌓 Toggle Dark Mode</button>
  <button id="openTagStats">📊 View Tag Usage</button>
  <a href="https://discord.gg/h8ha9489tr" target="blank">📡 Join our Discord!</a>
</div>

<div class="nav-panel" id="tagsPanel">
  <a href="/tagging-center">🔖 Tagging Center</a>
  <a href="/search">🔍 Card Search</a>
</div>

<form id="logoutForm" action="/api/logout" method="GET" style="display: none;"></form>

<script>
  let openPanelId = null;

  function togglePanel(id) {
    const panel = document.getElementById(id);

    const isOpen = panel.style.display === 'flex';

    // Close all panels
    document.querySelectorAll('.nav-panel').forEach(p => p.style.display = 'none');

    // Toggle the selected one
    if (!isOpen) {
      panel.style.display = 'flex';
      openPanelId = id;
    } else {
      openPanelId = null;
    }
  }

  // Close panel on outside click
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.nav-panel') && !e.target.closest('.nav-item')) {
      document.querySelectorAll('.nav-panel').forEach(p => p.style.display = 'none');
      openPanelId = null;
    }
  });

  document.getElementById('logoutBtn')?.addEventListener('click', function () {
    document.getElementById('logoutForm').submit();
  });
</script>